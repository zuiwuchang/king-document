var __v="\n\u003cpre class='prettyprint linenums'\u003ebool WINAPI AntiHookSetToken();\nint _tmain(int argc, _TCHAR* argv[])\n{\n\tstd::locale locale=std::wcout.imbue(std::locale(\"chs\",std::locale::all ^ std::locale::numeric));\n\t//提權\n\tAntiHookSetToken();\n\t//設置pid\n\tDWORD pid=8964;\n    //建立快照\n\tHANDLE hProcess = CreateToolhelp32Snapshot(TH32CS_SNAPMODULE,pid);\n\tif(INVALID_HANDLE_VALUE != hProcess)\n\t{\n\t\tMODULEENTRY32 mod32 = {0};\n\t\tmod32.dwSize=sizeof(mod32);\n\t\tif(Module32First(hProcess,\u0026amp;mod32))\n\t\t{\n\t\t\tdo\n\t\t\t{\n\t\t\t\tstd::wcout\u0026lt;\u0026lt;mod32.modBaseAddr\t\t//模塊加載地址\n\t\t\t\t\t\u0026lt;\u0026lt;mod32.szExePath\u0026lt;\u0026lt;std::endl;\t//模塊全路徑\n\t\t\t}while(Module32Next(hProcess,\u0026amp;mod32));\n\t\t}\n\t}\n\n\tsystem(\"pause\");\n\treturn 0;\n}\nbool WINAPI AntiHookSetToken()\n{\n\tHANDLE hToken;\n\tif(OpenProcessToken(GetCurrentProcess(),TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY,\u0026amp;hToken))\n\t{\n\t\tTOKEN_PRIVILEGES tkp;\n\n\t\tLookupPrivilegeValue( NULL,SE_DEBUG_NAME,\u0026amp;tkp.Privileges[0].Luid );//修改进程权限\n\t\ttkp.PrivilegeCount=1;\n\t\ttkp.Privileges[0].Attributes=SE_PRIVILEGE_ENABLED;\n\t\tAdjustTokenPrivileges( hToken,FALSE,\u0026amp;tkp,sizeof tkp,NULL,NULL );//通知系统修改进程权限\n\n\t\tif(GetLastError()!=ERROR_SUCCESS)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\u003c/pre\u003e"
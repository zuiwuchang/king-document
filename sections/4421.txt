var __v="\u003cstrong\u003eapp.go\u003c/strong\u003e\n\u003cpre class='prettyprint linenums'\u003efunc (c App) Echo(ws revel.ServerWebSocket) revel.Result {\n\tfmt.Println(\"websocket in\", c.Request.RemoteAddr)\n\tvar e error\n\tvar reply string\n\tfor {\n\t\tif e = ws.MessageReceiveJSON(\u0026amp;reply); e != nil {\n\t\t\tfmt.Println(\"Can't receive\")\n\t\t\tbreak\n\t\t}\n\n\t\tfmt.Println(\"Received back from client: \" + reply)\n\n\t\tmsg := \"Received:  \" + reply\n\t\tfmt.Println(\"Sending to client: \" + msg)\n\t\tif e = ws.MessageSendJSON(msg); e != nil {\n\t\t\tfmt.Println(\"Can't send\")\n\t\t\tbreak\n\t\t}\n\t}\n\n\tfmt.Println(\"websocket out\", c.Request.RemoteAddr)\n\treturn nil\n}\n\u003c/pre\u003e\n\u003cstrong\u003e*.html\u003c/strong\u003e\n\n\u003cpre class='prettyprint linenums'\u003e{{set . \"title\" \"Home\"}}\n{{template \"header.html\" .}}\n\n\n\n\n\u0026lt;div class=\"container\"\u0026gt;\n\n\u0026lt;div class=\"row\"\u0026gt;\n\t\u0026lt;p id=\"viewStatus\"\u0026gt;none\u0026lt;/p\u0026gt;\n\u0026lt;/div\u0026gt;\n\n\u0026lt;div class=\"row\"\u0026gt;\n\t\u0026lt;textarea  id=\"valText\" style=\"height: 200px;width: 100%;\"\u0026gt;\u0026lt;/textarea\u0026gt;\n\u0026lt;/div\u0026gt;\n\n\u0026lt;div class=\"row\"\u0026gt;\n\t\u0026lt;button class=\"btn btn-default\" id=\"btnConnect\"\u0026gt;connect\u0026lt;/button\u0026gt;\n\t\u0026lt;button class=\"btn btn-default\" id=\"btnSend\"\u0026gt;send\u0026lt;/button\u0026gt;\n\t\u0026lt;button class=\"btn btn-default\" id=\"btnClose\"\u0026gt;close\u0026lt;/button\u0026gt;\n\u0026lt;/div\u0026gt;\n\n\u0026lt;div class=\"row\"\u0026gt;\n\u0026lt;pre id=\"view\" style=\"height: 400px;\"\u0026gt;\n\u0026lt;/pre\u0026gt;\t\n\u0026lt;/div\u0026gt;\n\n\u0026lt;/div\u0026gt;\n{{template \"footer.html\" .}}\n\n\u0026lt;script type=\"text/javascript\"\u0026gt;\n$(document).ready(function() {\n\tvar jqStatus = $(\"#viewStatus\");\n\tvar ws = null;\n\t$(\"#btnConnect\").click(function(event) {\n\t\t//連接 服務器 創建 websocket\n\t\tws = new WebSocket(\"ws://127.0.0.1:9001/app/echo\");\n\t\tvar ok = false;\n\t\tws.onopen = function(evt){\n\t\t\tok = true;\n\t\t\tjqStatus.text(\"連接成功 state : \" + ws.readyState)\n\t\t};\n\t\tws.onerror = function(evt){\n\t\t\tjqStatus.text(\"無法連接到服務器\");\n\t\t};\n\t\tws.onclose = function(evt){\n\t\t\tws = null;\n\t\t\tif(ok){\n\t\t\t\tjqStatus.text(\"連接已經斷開\");\n\t\t\t}\n\t\t};\n \n\t\tws.onmessage = function(evt){\n\t\t\t//接收數據\n\t\t\t$(\"#view\").text(evt.data);\n\t\t};\n\t});\n\t//關閉\n\t$(\"#btnClose\").click(function(){\n\t\tif(ws){\n\t\t\tws.close();\n\t\t\t\n\t\t}\n\t});\n\t//發送 數據\n\t$(\"#btnSend\").click(function(event) {\n\t\tif(!ws || ws.readyState != 1){\n\t\t\treturn;\n\t\t}\n\t\tvar val = $(\"#valText\").val();\n\t\tws.send(val);\n\t});\n});\n\u0026lt;/script\u0026gt;\u003c/pre\u003e"
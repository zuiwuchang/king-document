var __v="\u003cpre class='k-pre'\u003ess-redir 可以配合 iptables 實現 透明代理\u003c/pre\u003e\n\u003col\u003e\n\t\u003cli\u003e使用 ss-redir 連接 shadowsocks 服務器\n\u003cpre class='prettyprint linenums'\u003ess-redir -b 0.0.0.0 -l 1911 -s ssh.xxx.com -p 1911  -k passwd  m rc4-md5 --reuse-port --fast-open\u003c/pre\u003e\u003c/li\u003e\n\t\u003cli\u003e開啓網卡轉發功能\u003cpre class='k-pre'\u003e# 檢查 是否啓用 網卡轉發 如果爲1 則以開啓\ncat /proc/sys/net/ipv4/ip_forward\n\n# 如果爲0 編輯 /etc/sysctl.conf 添加如下設置\nnet.ipv4.ip_forward=1\n# 執行 如下指令使用 修改立刻生效\nsysctl -p\u003c/pre\u003e\n\u003c/li\u003e\n\t\u003cli\u003e修改 iptables 規則\n\u003cpre class='prettyprint linenums'\u003e# 放行 到 ss-redir 的tcp連接\niptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 1911 -j ACCEPT\n\u003c/pre\u003e\n\u003cpre class='prettyprint linenums'\u003e\n# 創建 nat/tcp 轉發鏈 用於 轉發 tcp流\niptables -t nat -N SS-TCP\n\n# 放行 環回地址 保留地址 特殊地址\niptables -t nat -A SS-TCP -d 0/8 -j RETURN\niptables -t nat -A SS-TCP -d 127/8 -j RETURN\niptables -t nat -A SS-TCP -d 10/8 -j RETURN\niptables -t nat -A SS-TCP -d 169.254/16 -j RETURN\niptables -t nat -A SS-TCP -d 172.16/12 -j RETURN\niptables -t nat -A SS-TCP -d 192.168/16 -j RETURN\niptables -t nat -A SS-TCP -d 224/4 -j RETURN\niptables -t nat -A SS-TCP -d 240/4 -j RETURN\n\n# 放行 發往 ss-server 服務器的 數據 需要將 -d 地址 改爲服務器 ip\niptables -t nat -A SS-TCP -d x.x.x.x -j RETURN\n\n# 重定向 tcp 數據包到 ss-redir 監聽端口\niptables -t nat -A SS-TCP -p tcp -j REDIRECT --to-ports 1911\n\n# 本機 tcp 數據包流向 SS-TCP 鏈\niptables -t nat -A OUTPUT -p tcp -j SS-TCP\n# 內網 tcp 數據包流向 SS-TCP 鏈\niptables -t nat -A PREROUTING -p tcp -s 192.168/16 -j SS-TCP\n\n# 內網數據包源 NAT\niptables -t nat -A POSTROUTING -s 192.168/16 -j MASQUERADE\n\u003c/pre\u003e\u003c/li\u003e\n\u003c/ol\u003e\n"
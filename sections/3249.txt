var __v="\n\u003cpre class='prettyprint linenums'\u003eextern \"C\" ULONG KeServiceDescriptorTable;\n#pragma INIT_MEMORY\nULONG GetCurFunctionAddr(ULONG index)\n{\n\tULONG function_addr;\n\t__asm\n\t{\n\t\tpush eax;\n\t\tpush ebx;\n\t\t\tmov eax,KeServiceDescriptorTable;\n\t\t\tmov eax,[eax];\n\t\t\tmov ebx,index;\t//函数索引\n\t\t\tshl ebx,2;\t\t//计算函数偏移 左移两位 相当于*4 或 imul ebx,ebx,4 \n\t\t\tadd eax,ebx;\t\n\t\t\tmov eax,[eax];\n\t\t\tmov function_addr,eax;\n\t\tpop ebx;\n\t\tpop eax;\n\t}\n\treturn function_addr;\n}\u003c/pre\u003e"
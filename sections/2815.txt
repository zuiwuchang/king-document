var __v="\n\u003cpre class='prettyprint linenums'\u003eHKEY hKey_exe=NULL,hKey_dll=NULL;\nDWORD dwDisposition;\n\nif(ERROR_SUCCESS!=RegCreateKeyEx(HKEY_CLASSES_ROOT ,L\"exefile\\\\shell\\\\Scan with WinPe\\\\command\",0,NULL,REG_OPTION_VOLATILE,KEY_ALL_ACCESS,NULL,\u0026amp;hKey_exe,\u0026amp;dwDisposition)\n\t|| ERROR_SUCCESS!=RegCreateKeyEx(HKEY_CLASSES_ROOT ,L\"dllfile\\\\shell\\\\Scan with WinPe\\\\command\",0,NULL,REG_OPTION_VOLATILE,KEY_ALL_ACCESS,NULL,\u0026amp;hKey_dll,\u0026amp;dwDisposition)\n\t)\n{\n\tif(hKey_exe)\n\t{\n\t\tRegCloseKey(hKey_exe);\n\t}\n\tif(hKey_dll)\n\t{\n\t\tRegCloseKey(hKey_dll);\n\t}\n\tMessageBox(L\"无法添加关联 创建注册表信息失败\");\n\treturn;\n}\n\nwchar_t file_path[MAX_PATH]={0};\nGetModuleFileName(NULL,file_path,sizeof(file_path));\nCString tmp_key_value;\ntmp_key_value.Format(L\"\\\"%s\\\" \\\"%%1\\\"\",file_path);\nif(ERROR_SUCCESS!=RegSetValueEx(hKey_exe,NULL,0,REG_SZ,(const BYTE*)tmp_key_value.GetBuffer(),sizeof(wchar_t)*(tmp_key_value.GetLength()+1))\n\t|| ERROR_SUCCESS!=RegSetValueEx(hKey_dll,NULL,0,REG_SZ,(const BYTE*)tmp_key_value.GetBuffer(),sizeof(wchar_t)*(tmp_key_value.GetLength()+1))\n\t)\n{\n\tMessageBox(L\"无法添加关联 写入注册表信息失败\");\n}\n\n\nRegCloseKey(hKey_exe);\nRegCloseKey(hKey_dll);\u003c/pre\u003e"
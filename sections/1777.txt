var __v="\n\u003cpre class='prettyprint linenums'\u003e/***************************************************************\n * Name:      PrinterTextMain.cpp\n * Purpose:   Code for Application Frame\n * Author:    zuiwuchang (zuiwuchang@gmail.com)\n * Created:   2014-09-25\n * Copyright: zuiwuchang (http://zuiwuchang20031230.blogspot.com/)\n * License:\n **************************************************************/\n\n#ifdef WX_PRECOMP\n#include \"wx_pch.h\"\n#endif\n\n#ifdef __BORLANDC__\n#pragma hdrstop\n#endif //__BORLANDC__\n\n#include \"PrinterTextMain.h\"\n#include \"darkPrintout.h\"\n//helper functions\nenum wxbuildinfoformat {\n    short_f, long_f };\n\nwxString wxbuildinfo(wxbuildinfoformat format)\n{\n    wxString wxbuild(wxVERSION_STRING);\n\n    if (format == long_f )\n    {\n#if defined(__WXMSW__)\n        wxbuild \u0026lt;\u0026lt; _T(\"-Windows\");\n#elif defined(__WXMAC__)\n        wxbuild \u0026lt;\u0026lt; _T(\"-Mac\");\n#elif defined(__UNIX__)\n        wxbuild \u0026lt;\u0026lt; _T(\"-Linux\");\n#endif\n\n#if wxUSE_UNICODE\n        wxbuild \u0026lt;\u0026lt; _T(\"-Unicode build\");\n#else\n        wxbuild \u0026lt;\u0026lt; _T(\"-ANSI build\");\n#endif // wxUSE_UNICODE\n    }\n\n    return wxbuild;\n}\n\nBEGIN_EVENT_TABLE(PrinterTextFrame, wxFrame)\n    EVT_CLOSE(PrinterTextFrame::OnClose)\n    EVT_MENU(idMenuQuit, PrinterTextFrame::OnQuit)\n    EVT_MENU(idMenuAbout, PrinterTextFrame::OnAbout)\n    EVT_BUTTON(idPrinterOk,PrinterTextFrame::OnClickPrinterOk)\n    EVT_BUTTON(idPrinterView,PrinterTextFrame::OnClickPrinterView)\nEND_EVENT_TABLE()\n\nPrinterTextFrame::PrinterTextFrame(wxFrame *frame, const wxString\u0026amp; title)\n    : wxFrame(frame, -1, title)\n{\n#if wxUSE_MENUS\n    // create a menu bar\n    wxMenuBar* mbar = new wxMenuBar();\n    wxMenu* fileMenu = new wxMenu(_T(\"\"));\n    fileMenu-\u0026gt;Append(idMenuQuit, _(\"\u0026amp;Quit\\tAlt-F4\"), _(\"Quit the application\"));\n    mbar-\u0026gt;Append(fileMenu, _(\"\u0026amp;File\"));\n\n    wxMenu* helpMenu = new wxMenu(_T(\"\"));\n    helpMenu-\u0026gt;Append(idMenuAbout, _(\"\u0026amp;About\\tF1\"), _(\"Show info about this application\"));\n    mbar-\u0026gt;Append(helpMenu, _(\"\u0026amp;Help\"));\n\n    SetMenuBar(mbar);\n#endif // wxUSE_MENUS\n\n#if wxUSE_STATUSBAR\n    // create a status bar with some information about the used wxWidgets version\n    CreateStatusBar(2);\n    SetStatusText(_(\"Hello Code::Blocks user!\"),0);\n    SetStatusText(wxbuildinfo(short_f), 1);\n#endif // wxUSE_STATUSBAR\n\n    wxBoxSizer* top_sizer=new wxBoxSizer(wxVERTICAL);\n\ttop_sizer-\u0026gt;Add(new wxButton(this,idPrinterOk,_(\"Printer\")),1,wxEXPAND|wxALL,5);\n\ttop_sizer-\u0026gt;Add(new wxButton(this,idPrinterView,_(\"View\")),1,wxALL,5);\n\n\tSetSizer(top_sizer);\n\t//top_sizer-\u0026gt;Fit(this);\n\ttop_sizer-\u0026gt;SetSizeHints(this);\n}\n\n\nPrinterTextFrame::~PrinterTextFrame()\n{\n}\n\nvoid PrinterTextFrame::OnClose(wxCloseEvent \u0026amp;event)\n{\n    Destroy();\n}\n\nvoid PrinterTextFrame::OnQuit(wxCommandEvent \u0026amp;event)\n{\n    Destroy();\n}\n\nvoid PrinterTextFrame::OnAbout(wxCommandEvent \u0026amp;event)\n{\n    wxString msg = wxbuildinfo(long_f);\n    wxMessageBox(msg, _(\"Welcome to...\"));\n}\nvoid PrinterTextFrame::OnClickPrinterOk(wxCommandEvent\u0026amp; event)\n{\n    //打印對話框設置\n    wxPrintDialogData printDialogData;\n    printDialogData.SetFromPage(1);\n    printDialogData.SetToPage(11);\n\n    wxPrinter printer(\u0026amp;printDialogData);\n    darkPrintout printout(this, _(\"My printout\"));\n\n    //開始打印\n    if (!printer.Print(this, \u0026amp;printout, true /*prompt*/))\n    {\n        if (wxPrinter::GetLastError() == wxPRINTER_ERROR)\n        {\n            wxLogError(wxT(\"There was a problem printing. Perhaps your current printer is not set correctly?\"));\n        }\n        else\n        {\n            wxLogMessage(wxT(\"You canceled printing\"));\n        }\n    }\n    else\n    {\n        //打印成功 返回新的 打印設置\n        printer.GetPrintDialogData().GetPrintData();\n    }\n\n}\nvoid PrinterTextFrame::OnClickPrinterView(wxCommandEvent\u0026amp; event)\n{\n    // Pass two printout objects: for preview, and possible printing.\n    wxPrintDialogData printDialogData;\n    printDialogData.SetFromPage(1);\n    printDialogData.SetToPage(11);\n\n    \n    wxPrintPreview *preview =new wxPrintPreview(new darkPrintout(this), new darkPrintout(this), \u0026amp;printDialogData);\n    if (!preview-\u0026gt;IsOk())\n    {\n        delete preview;\n        wxLogError(wxT(\"There was a problem previewing.\\nPerhaps your current printer is not set correctly?\"));\n        return;\n    }\n\n    wxPreviewFrame *frame =\n        new wxPreviewFrame(preview, this, wxT(\"Demo Print Preview\"), wxPoint(100, 100), wxSize(600, 650));\n    frame-\u0026gt;Centre(wxBOTH);\n    frame-\u0026gt;Initialize();\n    frame-\u0026gt;Show();\n}\u003c/pre\u003e"
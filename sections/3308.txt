var __v="\u003cpre class=\"k-pre\"\u003e//註冊一個回調函數\nNTSTATUS\n  PsSetLoadImageNotifyRoutine(\n    IN PLOAD_IMAGE_NOTIFY_ROUTINE  NotifyRoutine\t\t//回調函數\n    );\n    \n//回調函數聲明\nVOID\n(*PLOAD_IMAGE_NOTIFY_ROUTINE) (\n    IN PUNICODE_STRING  FullImageName,\t\t\t\t//映射文件名 如 a.exe\n    IN HANDLE  ProcessId, // where image is mapped\t\t//映射進程句柄\n    IN PIMAGE_INFO  ImageInfo\t\t\t\t\t//包含映射文件被映射到 詳情\n    );\n\n//IMAGE_INFO 結構\ntypedef struct  _IMAGE_INFO {\n    union {\n        ULONG  Properties;\n        struct {\n            ULONG ImageAddressingMode  : 8; //code addressing mode\t始終設置為IMAGE_ADDRESSING_MODE_32BIT\n            ULONG SystemModeImage      : 1; //system mode image\n            ULONG ImageMappedToAllPids : 1; //mapped in all processes\t始終設置為0\n            ULONG Reserved             : 22;\t\t\t\t始終設置為0\n        };\n    };\n    PVOID  ImageBase;\t\t\t\t//映射到VA\n    ULONG  ImageSelector;\t\t\t//始終為0\n    ULONG  ImageSize;\t\t\t\t//映射後佔用內存大小\n    ULONG  ImageSectionNumber;\t\t\t//始終為0\n} IMAGE_INFO, *PIMAGE_INFO;\n\n//移除回調函數\nNTSTATUS\n  PsRemoveLoadImageNotifyRoutine(\n    IN PLOAD_IMAGE_NOTIFY_ROUTINE  NotifyRoutine \n    );\n\u003c/pre\u003e"
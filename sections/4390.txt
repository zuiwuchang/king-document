var __v="\u003cstrong\u003eserver\u003c/strong\u003e\n\u003cpre class='prettyprint linenums'\u003epackage main\n\nimport (\n\t\"fmt\"\n\t\"golang.org/x/net/http2\"\n\t\"log\"\n\t\"net/http\"\n\t\"time\"\n)\n\nfunc Handler(\n\tw http.ResponseWriter,\n\tr *http.Request,\n) {\n\tfmt.Println(\"do\", r.RequestURI)\n\tif r.RequestURI == \"/1\" {\n\t\ttime.Sleep(time.Second)\n\t\tfmt.Fprint(w, \"1 rs\")\n\t} else if r.RequestURI == \"/2\" {\n\t\tfmt.Fprint(w, \"2 rs\")\n\t} else {\n\t\tfmt.Fprint(w, \"other rs\")\n\t}\n}\n\nconst (\n\tLAddr = \":8080\"\n)\n\nfunc main() {\n\t//創建 http 服務器\n\tsrv := \u0026amp;http.Server{\n\t\tAddr: LAddr,\n\t}\n\t//配置 h2\n\te := http2.ConfigureServer(srv, \u0026amp;http2.Server{})\n\tif e != nil {\n\t\tlog.Fatalln(e)\n\t}\n\n\t//註冊路由\n\thttp.HandleFunc(\"/\", Handler)\n\n\t//監聽並工作\n\tlog.Println(\"work at :\", LAddr)\n\te = srv.ListenAndServeTLS(\"go.crt\", \"go.key\")\n\tif e != nil {\n\t\tlog.Fatalln(e)\n\t}\n}\n\u003c/pre\u003e\n\u003cstrong\u003eclient\u003c/strong\u003e\n\n\u003cpre class='prettyprint linenums'\u003epackage main\n\nimport (\n\t\"crypto/tls\"\n\t\"fmt\"\n\t\"golang.org/x/net/http2\"\n\t\"io/ioutil\"\n\t\"log\"\n\t\"net/http\"\n)\n\nfunc main() {\n\t//創建 h2 客戶端\n\tclient := http.Client{\n\t\t//制度傳輸協議\n\t\tTransport: \u0026amp;http2.Transport{\n\t\t\t//配置 ssl 加密\n\t\t\tTLSClientConfig: \u0026amp;tls.Config{\n\t\t\t\t//不驗證 證書 和 域名是否匹配\n\t\t\t\tInsecureSkipVerify: true,\n\t\t\t},\n\t\t},\n\t}\n\n\t//多路復用 發送 多個 請求 只會使用 同個 socket\n\tch := make(chan (int))\n\tgo getUrl(ch, \u0026amp;client, \"1\")\n\tgo getUrl(ch, \u0026amp;client, \"2\")\n\n\tsum := 0\n\tfor sum \u0026lt; 2 {\n\t\t\u0026lt;-ch\n\t\tsum++\n\t}\n\n}\nfunc getUrl(ch chan (int), client *http.Client, u string) {\n\tresp, err := client.Get(\"https://127.0.0.1:8080/\" + u)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\tbody, err := ioutil.ReadAll(resp.Body)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\tfmt.Println(string(body), body)\n\n\tif u == \"1\" {\n\t\tgetUrl(ch, client, \"3\")\n\t} else {\n\t\tch \u0026lt;- 1\n\t}\n}\n\u003c/pre\u003e"
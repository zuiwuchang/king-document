var __v="\n\u003cpre class='prettyprint linenums'\u003evoid CMAPDlg::OnBnClickedButton1()\n{\n\tint index\t=\tGetDlgItemInt(IDC_EDIT1);\n\n\tstd::pair\u0026lt;int,int\u0026gt; size\t=\twix.GetImageSize(index);\n\t\n\tGdiplus::Graphics graphics(m_hWnd);\n\n\tGdiplus::Bitmap bitmap(size.first,size.second);\n\t\n\tboost::shared_ptr\u0026lt;Gdiplus::BitmapData\u0026gt; bitmap_data_ptr\t=\tboost::make_shared\u0026lt;Gdiplus::BitmapData\u0026gt;();\n\n\t//設置調色板 sizeof(Gdiplus::ColorPalette) + (調色板顏色-1) *sizeof(DWORD)\n\tGdiplus::ColorPalette* palette_ptr\t=\t(Gdiplus::ColorPalette*)malloc(sizeof(Gdiplus::ColorPalette) + 255 *sizeof(DWORD));\n\tpalette_ptr-\u0026gt;Count\t=\t256;\n\tpalette_ptr-\u0026gt;Flags\t=\t0;\n\tfor(int i=0;i\u0026lt;256;++i)\n\t{\n\t\tpalette_ptr-\u0026gt;Entries[i]\t=\twix.wil_header_.palette[i] | 0xFF000000;\t//增加A分量\n\t}\n\tbitmap.SetPalette(palette_ptr);\n\tfree(palette_ptr);\n\t\n\tbitmap.LockBits(\u0026amp;Gdiplus::Rect(0,0,size.first,size.second),Gdiplus::ImageLockModeWrite,PixelFormat8bppIndexed,bitmap_data_ptr.get());\n\tmemcpy(bitmap_data_ptr-\u0026gt;Scan0,wix.GetImageData(index)-\u0026gt;data(),wix.GetImageData(index)-\u0026gt;size());\n\tbitmap.UnlockBits(bitmap_data_ptr.get());\n\n\t//數據是直接從文件讀取的 故需要翻轉圖片\n\tbitmap.RotateFlip(Gdiplus::Rotate180FlipX);\t\t//文件存儲數據和內存數據正好相反(故相當於旋轉了180度)\n\t\n\tgraphics.DrawImage(\u0026amp;bitmap\n\t\t,Gdiplus::Point(50,50)\n\t\t);\n}\u003c/pre\u003e"
var __v="\n\u003cpre class='prettyprint linenums'\u003e#ifndef _DARK_DIRECT_2D_\n#define _DARK_DIRECT_2D_\n//#include\u0026lt;d2d1.h\u0026gt;\n//#pragma comment(lib,\"D2d1.lib\")\n\n#include \"wic.hpp\"\n\nnamespace dark\n{\n\tnamespace direct\n\t{\n\t\ttypedef boost::shared_ptr\u0026lt;ID2D1Bitmap\u0026gt; d2d1_bitmap_ptr_t;\n\t\tclass direct2d\n\t\t{\n\t\tprotected:\n\t\t\tID2D1Factory* d2d_factory_ptr_;\n\t\t\tID2D1HwndRenderTarget* d2d_target_ptr_;\n\n\t\t\twic_factory wic_factory_;\n\t\t\tHWND hWnd_;\n\t\t\tD2D1_RECT_F rect_;\n\t\tpublic:\n\t\t\tdirect2d()\n\t\t\t{\n\t\t\t\td2d_factory_ptr_\t=\tNULL;\n\t\t\t\td2d_target_ptr_\t\t=\tNULL;\n\n\t\t\t\thWnd_\t=\tNULL;\n\t\t\t}\n\t\t\tvirtual HRESULT initialize(HWND hWnd,UINT32 width,UINT32 height)\n\t\t\t{\n\t\t\t\t//創建wic設置\n\t\t\t\tHRESULT\terror\t=\twic_factory_.initialize();\n\t\t\t\tif(S_OK\t!=\terror)\n\t\t\t\t{\n\t\t\t\t\trelease();\n\t\t\t\t\treturn error;  \n\t\t\t\t}\n\n\t\t\t\t//創建d2d工廠\n\t\t\t\terror = D2D1CreateFactory(D2D1_FACTORY_TYPE_SINGLE_THREADED,\u0026amp;d2d_factory_ptr_);\n\t\t\t\tif(error\t!=\tS_OK)\n\t\t\t\t{\n\t\t\t\t\trelease();\n\t\t\t\t\treturn error;   \n\t\t\t\t}\n\n\t\t\t\t//創建繪製目標 \n\t\t\t\terror\t=\td2d_factory_ptr_-\u0026gt;CreateHwndRenderTarget(D2D1::RenderTargetProperties()\n\t\t\t\t\t,D2D1::HwndRenderTargetProperties(hWnd\t\t\t\t\t\n\t\t\t\t\t\t,D2D1::SizeU(width,height)\n\t\t\t\t\t\t) \n\t\t\t\t\t,\u0026amp;d2d_target_ptr_\n\t\t \n\t\t\t\t\t);\n\t\t\t\tif(error\t!=\tS_OK)\n\t\t\t\t{\n\t\t\t\t\trelease();\n\t\t\t\t\treturn error;   \n\t\t\t\t}\n\n\t\t\t\trect_.left\t\t=\t0;\n\t\t\t\trect_.right\t\t=\t(FLOAT)width;\n\t\t\t\trect_.top\t\t=\t0;\n\t\t\t\trect_.bottom\t=\t(FLOAT)height;\n\t\t\t\thWnd_\t=\thWnd;\n\n\t\t\t\t//test\n\t\t\t\tinit();\n\t\t\t\treturn S_OK;\n\t\t\t}\n\t\t\tvirtual void release()\n\t\t\t{\n\t\t\t\t//test\n\t\t\t\tfree();\n\n\t\t\t\twic_factory_.release();\n\n\t\t\t\tDARK_SAFE_RELEASE_COM(d2d_target_ptr_);\n\t\t\t\tDARK_SAFE_RELEASE_COM(d2d_factory_ptr_);\n\t\t\t\thWnd_\t=\tNULL;\n\t\t\t}\n\n\n\t\t\td2d1_bitmap_ptr_t load_bitmap(const std::wstring\u0026amp; path)\n\t\t\t{\n\t\t\t\td2d1_bitmap_ptr_t rs;\n\t\t\t\t//使用wic設備加載位圖\n\t\t\t\twic_converter_bitmap_ptr_t wic_converter_bitmap_ptr\t=\twic_factory_.load_bitmap(path);\n\t\t\t\tif(wic_converter_bitmap_ptr)\n\t\t\t\t{\n\t\t\t\t\tID2D1Bitmap* d2d_bitmap_ptr\t=\tNULL;\n\t\t\t\t\t//由WCI位圖轉D2D位圖\n\t\t\t\t\tif(S_OK == d2d_target_ptr_-\u0026gt;CreateBitmapFromWicBitmap(wic_converter_bitmap_ptr.get()\n\t\t\t\t\t\t,NULL\n\t\t\t\t\t\t,\u0026amp;d2d_bitmap_ptr\n\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\trs\t=\td2d1_bitmap_ptr_t(d2d_bitmap_ptr,dark::com_tools::delete_com\u0026lt;ID2D1Bitmap\u0026gt;);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn rs;\n\t\t\t}\n\n\t\t\tvirtual void Draw()\n\t\t\t{\n\t\t\t\td2d_target_ptr_-\u0026gt;BeginDraw();\n\t\t\t\td2d_target_ptr_-\u0026gt;Clear(D2D1::ColorF(D2D1::ColorF::White));\t//以指定顏色 清除背景\n\t\t\t\t{\n\t\t\t\t\td2d_target_ptr_-\u0026gt;DrawBitmap(bitmap_ptr_.get()\n\t\t\t\t\t\t,rect_\n\t\t\t\t\t\t);\n\t\t\t\t}\t\t\t\n\t\t\t\td2d_target_ptr_-\u0026gt;EndDraw();\t//成功繪製返回 S_OK\t\n\t\t\t}\n\n\t\t\t//test\n\t\tprotected:\n\t\t\td2d1_bitmap_ptr_t bitmap_ptr_;\n\t\t\tvoid init()\n\t\t\t{\n\t\t\t\tbitmap_ptr_\t=\tload_bitmap(L\"test.jpg\");\n\t\t\t}\n\t\t\tvoid free()\n\t\t\t{\n\t\t\t\tbitmap_ptr_\t=\tNULL;\n\t\t\t}\n\t\t};\n\t};\n};\n\n#endif\t//_DARK_DIRECT_2D_\u003c/pre\u003e"
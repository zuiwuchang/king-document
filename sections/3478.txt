var __v="\n\u003cpre class='prettyprint linenums'\u003ecase WM_PAINT:\n{\t\t\t\n\tRECT rect;\n\tGetClientRect(hWnd,\u0026amp;rect);\n\t\n\tUINT width\t=\trect.right - rect.left;\n\tUINT height\t=\trect.bottom - rect.top;\n\t\n\tIWICImagingFactory *pIWICFactory = NULL;\n\tIWICBitmapDecoder *pIWICDecoder = NULL; \n\tIWICBitmapFrameDecode* pIWICBitmap\t=\tNULL;\n\t//創建WIC工廠\n\tHRESULT hr = CoCreateInstance(\n\t\tCLSID_WICImagingFactory,\n\t\tNULL,\n\t\tCLSCTX_INPROC_SERVER,\n\t\tIID_IWICImagingFactory,\n\t\t(LPVOID*)\u0026amp;pIWICFactory\n\t\t);\n\n\t//創建編碼解析器\n\tassert(S_OK ==  pIWICFactory-\u0026gt;CreateDecoderFromFilename(L\"test.jpg\"\n\t\t\t\t\t\t\t,NULL\n\t\t\t\t\t\t\t,GENERIC_READ\n\t\t\t\t\t\t\t,WICDecodeMetadataCacheOnDemand\n\t\t\t\t\t\t\t,\u0026amp;pIWICDecoder\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t);\n\t\n\tUINT uiFrameCount = 0;\n\tassert(S_OK\t==\tpIWICDecoder-\u0026gt;GetFrameCount(\u0026amp;uiFrameCount)); \n\t//讀取圖像第1真\n\tassert(S_OK\t==pIWICDecoder-\u0026gt;GetFrame(0,\u0026amp;pIWICBitmap));\n\t\n\n\t//縮放位圖\n\tIWICBitmapScaler* pIWICBitmapScale\t=\tNULL;\n\tassert(S_OK\t==\tpIWICFactory-\u0026gt;CreateBitmapScaler(\u0026amp;pIWICBitmapScale));\n\tpIWICBitmapScale-\u0026gt;Initialize(pIWICBitmap\n\t\t,width\n\t\t,height\n\t\t,WICBitmapInterpolationModeCubic\t\t//使用的插值算法\n\t\t);\n\n\t//轉換為D2D支持的格式 \n\tIWICFormatConverter* pIWICConverter\t=\tNULL;\n\tassert(S_OK == pIWICFactory-\u0026gt;CreateFormatConverter(\u0026amp;pIWICConverter));\n\tpIWICConverter-\u0026gt;Initialize(pIWICBitmapScale\n\t\t,GUID_WICPixelFormat32bppPBGRA\n\t\t,WICBitmapDitherTypeNone      \t\t\n\t\t,NULL         \n\t\t,0.f\n\t\t,WICBitmapPaletteTypeMedianCut\n    );\n\t\n\n\tID2D1Bitmap* d2d_bitmap_ptr\t=\tNULL;\n\n\t//由WCI位圖轉D2D位圖\n\tassert(S_OK == d2d_target_ptr-\u0026gt;CreateBitmapFromWicBitmap(pIWICConverter,NULL,\u0026amp;d2d_bitmap_ptr));\n\n\n\tif(pIWICBitmapScale)\n\t{\n\t\tpIWICBitmapScale-\u0026gt;Release();\n\t}\n\tif(pIWICConverter)\n\t{\n\t\tpIWICConverter-\u0026gt;Release();\n\t}\n\tif(pIWICBitmap)\n\t{\n\t\tpIWICBitmap-\u0026gt;Release();\n\t}\n\tif (pIWICFactory)\n\t{\n\t\tpIWICFactory-\u0026gt;Release();\n\t}\n\n\tif (pIWICDecoder)\n\t{\n\t\tpIWICDecoder-\u0026gt;Release();\n\t}\n\t\n\t//改變繪製目標區域大小\n\td2d_target_ptr-\u0026gt;Resize(D2D1::SizeU(width,height));\n\t\n\td2d_target_ptr-\u0026gt;BeginDraw();\n\td2d_target_ptr-\u0026gt;Clear(D2D1::ColorF(D2D1::ColorF::DarkBlue));\t//以指定顏色 清除背景\n\n\t\td2d_target_ptr-\u0026gt;DrawBitmap(d2d_bitmap_ptr);\n\t\t\n\t\n\td2d_target_ptr-\u0026gt;EndDraw();\t//成功繪製返回 S_OK\t\n\t\n\tif(d2d_bitmap_ptr)\n\t{\n\t\td2d_bitmap_ptr-\u0026gt;Release();\n\t}\n}\nbreak;\u003c/pre\u003e"
var __v="\u003cpre class=\"prettyprint linenums\"\u003eimport java.io.IOException;\nimport java.io.PrintWriter;\n\n\nimport java.sql.Connection;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\nimport java.sql.Statement;\nimport java.util.concurrent.Future;\n \nimport javax.naming.Context;\n//import javax.naming.Context;\nimport javax.naming.InitialContext;\nimport javax.naming.NamingException;\nimport javax.servlet.ServletException;\nimport javax.servlet.annotation.WebServlet;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\nimport org.apache.tomcat.jdbc.pool.DataSource;\n\n\n\n/**\n * Servlet implementation class Email\n */\n@WebServlet(\"/Email\")\npublic class Email extends HttpServlet {\n\tprivate static final long serialVersionUID = 1L;\n\n\t/**\n\t* @see HttpServlet#HttpServlet()\n\t*/\n\tpublic Email() {\n\t\tsuper();\n\t\t// TODO Auto-generated constructor stub\n\t}\n \n\t/**\n\t * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)\n\t */\n\tprotected void doGet(HttpServletRequest request, HttpServletResponse response)\n\t\tthrows ServletException, IOException {\n\t\tPrintWriter out = response.getWriter();\n\t\n\t\tContext initContext;\n\t\tConnection con = null; \n\t\ttry {\n\t\t\tinitContext = new InitialContext();\n\t\t\t DataSource datasource = (DataSource)initContext.lookup(\"java:comp/env/jdbc/MariaDB\");\n\t\t\t\n\t\t\t//一般獲取連接\n\t\t\t{\n\t\t\t\t\tFuture\u0026lt;Connection\u0026gt; future = datasource.getConnectionAsync();\n\t\t\t\t\twhile (!future.isDone()) \n\t\t\t\t\t{\n\t\t\t\t\t\t System.out.println(\"wait connect . do other thing\");\n\t\t\t\t\t\t try {\n\t\t\t\t\t\t\tThread.sleep(100); //simulate work\n\t\t\t\t\t\t}catch (InterruptedException x) {\n\t\t\t\t\t\t\tThread.currentThread().interrupt();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\tcon = datasource.getConnection() ;\n\t\t\t}\n\t\t\t//同步 獲取連接\n\t\t\t{\n\t\t\t\t//con = datasource.getConnection();\n\t\t\t}\n\n\t\t\tStatement stm = con.createStatement();\n\t\t\tString sql =\"select id from test\";\n\n\t\t\t//執行 sql 遍歷結果\n\t\t\tResultSet rs = stm.executeQuery(sql);\n\t\t\twhile(rs.next())\n\t\t\t{\n\t\t\t\tout.println(rs.getInt(\"id\"));\n\t\t\t}\n\t\t\trs.close();\n\t\t\tstm.close();\n\t\t} catch (NamingException e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\te.printStackTrace();\n\t\t}\n\t\tcatch (SQLException e) {\n\t\t\te.printStackTrace();\n\t\t}finally {\n\t\t\tif (con!=null) try {con.close();}catch (Exception ignore) {}\n\t\t}\n\t}\n\n\t/**\n\t * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)\n\t */\n\tprotected void doPost(HttpServletRequest request, HttpServletResponse response) \n\t\tthrows ServletException, IOException {\n\t\t// TODO Auto-generated method stub\n\t}\n}\u003c/pre\u003e"
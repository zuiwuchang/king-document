var __v="\u003cpre class=\"prettyprint linenums\"\u003evar Async = {\n\t//流程 狀態\n\tSTATUS_NONE:\"none\",\n\tSTATUS_RUNING:\"runing\",\n\tSTATUS_OK:\"ok\",\n\tSTATUS_ERROR:\"error\",\n\n\t//創建 一個 流程\n\tNew:function(){\n\t\t//保存流程\n\t\tvar _funcs = [\n\t\t\t/*{\n\t\t\t\tFunc:...,//流程函數\n\t\t\t\tOnError:...,//錯誤處理函數\n\t\t\t},*/\n\t\t];\n\t\tvar _n = 0;\t//當前 流程進度\n\n\t\t//回調通知\n\t\tvar onOk;\n\t\tvar onEnd;\n\t\tvar onError;\n\t\tvar _funcError;\n\n\t\tvar ctxObj = this;\n\t\tvar _status = ctxObj.STATUS_NONE;\n\t\treturn {\n\t\t\t//返回 流程 狀態\n\t\t\tStatus:function(){\n\t\t\t\treturn _status;\n\t\t\t},\n\t\t\t//增加一個 流程\n\t\t\tSync:function(funcSync,funcError){\n\t\t\t\tvar funcs = _funcs;\n\t\t\t\tfuncs.push({\n\t\t\t\t\tFunc:funcSync,\n\t\t\t\t\tOnError:funcError,\n\t\t\t\t});\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\t//通知 執行下個流程\n\t\t\tNotify:function(channel){\n\t\t\t\tif(_status != ctxObj.STATUS_RUNING){\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\n\t\t\t\tvar err = channel.Error;\n\t\t\t\tvar ctx = channel.Content;\n\t\t\t\t//流程錯誤\n\t\t\t\tif(err){\n\t\t\t\t\t_status = ctxObj.STATUS_ERROR;\n\n\t\t\t\t\t//通知 錯誤處理\n\t\t\t\t\tvar funcError = _funcError;\n\t\t\t\t\tvar nextError = true;\n\t\t\t\t\tif(funcError){\n\t\t\t\t\t\tnextError = funcError(err,ctx);\n\t\t\t\t\t}\n\t\t\t\t\t//通知 全局 錯誤 處理\n\t\t\t\t\tif(nextError \u0026amp;\u0026amp; onError){\n\t\t\t\t\t\tonError(err,ctx);\n\t\t\t\t\t}\n\t\t\t\t\t//通知 流程結束\n\t\t\t\t\tif(onEnd){\n\t\t\t\t\t\tonEnd(err,ctx);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}else{\n\t\t\t\t\terr = null;\n\t\t\t\t}\n\n\t\t\t\tvar funcs = _funcs;\n\t\t\t\tvar len = funcs.length;\n\t\t\t\tif(len \u0026gt; _n){\n\t\t\t\t\t//執行 流程\n\t\t\t\t\tvar obj = funcs[_n];\n\t\t\t\t\t_funcError = obj.OnError;\n\t\t\t\t\tobj.Func(this,channel.Content);\n\t\t\t\t\t++_n;\n\t\t\t\t}else{\n\t\t\t\t\t//所有流程 執行完成 發送 成功 通知\n\t\t\t\t\t_status = ctxObj.STATUS_OK;\n\t\t\t\t\tif(onOk){\n\t\t\t\t\t\tonOk(ctx);\n\t\t\t\t\t}\n\n\t\t\t\t\tif(onEnd){\n\t\t\t\t\t\tonEnd(err,ctx);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\t//開始 執行 流程\n\t\t\tDo:function(obj){\n\t\t\t\tif(_status != ctxObj.STATUS_NONE){\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t\t_status = ctxObj.STATUS_RUNING;\n\n\t\t\t\tif(!obj){\n\t\t\t\t\tobj = {};\n\t\t\t\t}\n\t\t\t\tonOk = obj.Ok;\n\t\t\t\tonEnd = obj.End;\n\t\t\t\tonError = obj.Error;\n\t\t\t\tthis.Notify({});\n\n\t\t\t\treturn this;\n\t\t\t},\n\t\t};\n\t},\n};\u003c/pre\u003e"
var __v="\n\u003cpre class='prettyprint linenums'\u003e#pragma once\n\n\n#ifdef __cplusplus\t//若是c++编译 以c符号方式导入\nextern \"C\"\n{\n#endif\n\n#include \u0026lt;NTDDK.h\u0026gt;\n\n#ifdef __cplusplus\n}\n#endif \n\n#define PAGE_MEMORY code_seg(\"PAGE\")\t\t//分页内存\n#define LOCKED_MEMORY code_seg()\t\t\t//非分页\n#define INIT_MEMORY code_seg(\"INIT\")\t\t//INIT内存 此内存指明只在加载驱动时加载 驱动加载成功后自动卸载\n\n//程序员自定义扩展设备结构 以描述不同设备的信息\ntypedef struct _DEVICE_EXTENSION {\n\tPDEVICE_OBJECT pDevice;\n\tUNICODE_STRING ustrDeviceName;\t//设备名称\n\tUNICODE_STRING ustrSymLinkName;\t//符号链接名\n} DEVICE_EXTENSION, *PDEVICE_EXTENSION;\n\n\n#define IOCTL_DIRECT_IN  CTL_CODE(FILE_DEVICE_UNKNOWN,0x800,METHOD_IN_DIRECT,FILE_WRITE_DATA | FILE_READ_DATA)\n#define IOCTL_DIRECT_HOOK CTL_CODE(FILE_DEVICE_UNKNOWN,0x801,METHOD_OUT_DIRECT,FILE_WRITE_DATA | FILE_READ_DATA)\n#define IOCTL_DIRECT_UNHOOK CTL_CODE(FILE_DEVICE_UNKNOWN,0x802,METHOD_OUT_DIRECT,FILE_WRITE_DATA | FILE_READ_DATA)\n\n// 函数声明\n\n//创建设备对象 辅助函数\nNTSTATUS CreateDevice (IN PDRIVER_OBJECT pDriverObject);\n//卸载例程函数 设备卸载时I/O管理器中的调用\nVOID UnloadDevice (IN PDRIVER_OBJECT pDriverObject);\n\n\nNTSTATUS CreateDispatchRoutine(IN PDEVICE_OBJECT pDevObj,IN PIRP pIrp);\nNTSTATUS CloseDispatchRoutine(IN PDEVICE_OBJECT pDevObj,IN PIRP pIrp);\nNTSTATUS ControlDispatchRoutine(IN PDEVICE_OBJECT pDevObj,IN PIRP pIrp);\n\nNTSTATUS WriteDirectIn(IN PIRP pIrp,ULONG inSize,ULONG outSize);\nvoid Hook();\nvoid UnHook();\n\nULONG GetCurFunctionAddr(ULONG index);\nULONG SetCurFunctionAddr(ULONG index,ULONG addr);\n\n//定义一个函数指针类型\nextern \"C\" typedef NTSTATUS  (__stdcall *HookNtOpenProcess)( \n\tOUT\tPHANDLE ProcessHandle, \n\tIN\tACCESS_MASK DesiredAccess, \n\tIN\tPOBJECT_ATTRIBUTES ObjectAttributes, \n\tIN\tPCLIENT_ID ClientId ) ;\n\n\n//HOOK 函数声明\nextern \"C\" NTSTATUS __stdcall MyNtOpenProcess( \n\tOUT\tPHANDLE ProcessHandle, \n\tIN\tACCESS_MASK DesiredAccess, \n\tIN\tPOBJECT_ATTRIBUTES ObjectAttributes, \n\tIN\tPCLIENT_ID ClientId );\u003c/pre\u003e"
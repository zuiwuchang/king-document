var __v="\n\u003cpre class='prettyprint linenums'\u003e#include\"myhook.h\"\n#include\"hook.h\"\nOldNtQueryInformationProcess RealNtQueryInformationProcess;\n\n#pragma PAGE_MEMORY\nextern \"C\"\nNTSTATUS __stdcall MyNtQueryInformationProcess(\n  __in       HANDLE ProcessHandle,\n  __in       PROCESSINFOCLASS ProcessInformationClass,\n  __out      PVOID ProcessInformation,\n  __in       ULONG ProcessInformationLength,\n  __out_opt  PULONG ReturnLength\n)\n{\n\t\n\tNTSTATUS status = STATUS_SUCCESS;\n\n\tstatus=RealNtQueryInformationProcess(ProcessHandle,ProcessInformationClass,ProcessInformation,ProcessInformationLength,ReturnLength);\n \n\tif(STATUS_SUCCESS==status \u0026amp;\u0026amp; 7==ProcessInformationClass)\n\t{\n\t\t*(ULONG*)ProcessInformation=0;\n\t\tKdPrint((\"%d\\n\",*(ULONG*)ProcessInformation));\n\t}\n\n\t\n\treturn status;\n}\n#pragma PAGE_MEMORY\nVOID Hook_NtQueryInformationProcess()\n{\n\tULONG index=0xEA;\n\tULONG my_address=(ULONG)MyNtQueryInformationProcess;\n\tULONG cur_address=GetCurSsdtFunctionAddr(index);\n\tif(my_address!=cur_address)\n\t{\n\t\tcur_address=SetCurSsdtFunctionAddr(index,my_address);\n\t\tRealNtQueryInformationProcess=(OldNtQueryInformationProcess)cur_address;\n\t\tKdPrint((\"Hook ok old NtQueryInformationProcess=0x%08X\",cur_address));\n\t}\n\telse\n\t{\n\t\tKdPrint((\"already Hook \"));\n\t}\n}\n#pragma PAGE_MEMORY\nVOID Unhook_NtQueryInformationProcess()\n{\n\tULONG index=0xEA;\n\tULONG my_address=(ULONG)MyNtQueryInformationProcess;\n\tULONG cur_address=GetCurSsdtFunctionAddr(index);\n\t\n\tif(my_address==cur_address)\n\t{\n\t\tcur_address=SetCurSsdtFunctionAddr(index,(ULONG)RealNtQueryInformationProcess);\n\t\tKdPrint((\"Unhook ok old NtQueryInformationProcess=0x%08X\",cur_address));\n\t}\n\telse\n\t{\n\t\tKdPrint((\"no my Hook \"));\n\t}\n}\u003c/pre\u003e"
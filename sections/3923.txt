var __v="\u003cpre class=\"k-pre\"\u003e此示例演示了如何找出 tcp 的 基礎服務提供者\n\u003c/pre\u003e\n\u003cpre class='prettyprint linenums'\u003e#include \u0026lt;iostream\u0026gt;\n\n\n#include \u0026lt;Winsock2.h\u0026gt;\n\n#define\tREG_PROTOCOL_CATALOG_KEY\tL\"SYSTEM\\\\CurrentControlSet\\\\Services\\\\WinSock2\\\\Parameters\\\\Protocol_Catalog9\\\\Catalog_Entries\"\n#define REG_PROTOCOL_CATALOG_ITEM\tL\"PackedCatalogItem\"\n\nstruct PackedCatalogItem\n{\n\tchar Path[MAX_PATH];\n\tWSAPROTOCOL_INFO Info;\n};\nvoid show_info(HKEY hKey,wchar_t* keyName);\nint _tmain(int argc, _TCHAR* argv[])\n{\n\tint succes = 0;\n\tHKEY hKey = NULL;\n\tif(ERROR_SUCCESS != RegOpenKeyEx(HKEY_LOCAL_MACHINE,REG_PROTOCOL_CATALOG_KEY,0,KEY_READ,\u0026amp;hKey))\n\t{\n\t\tsucces = 1;\n\t\tgoto End;\n\t}\n\t\n\tDWORD pos = 0;\n\twchar_t keyName[MAX_PATH];\n\twhile(RegEnumKey(hKey,pos,keyName, MAX_PATH) == ERROR_SUCCESS)\n\t{\n\t\tshow_info(hKey,keyName);\n\t\tpos++;\n\t}\nEnd:\n\tif(hKey)\n\t{\n\t\tRegCloseKey(hKey);\n\t}\n\n\tstd::system(\"pause\");\n\treturn succes;\n}\n\nvoid show_info(HKEY hKey,wchar_t* keyName)\n{\n\tHKEY hSubKey = NULL; \n\tif(ERROR_SUCCESS != RegOpenKeyEx(hKey,keyName,0,KEY_READ,\u0026amp;hSubKey))\n\t{\n\t\tgoto End;\n\t}\n\tPackedCatalogItem info;\n\tDWORD len = sizeof(info);\n\tif(ERROR_SUCCESS != RegQueryValueEx(hSubKey,REG_PROTOCOL_CATALOG_ITEM,0,NULL,(LPBYTE)\u0026amp;info,\u0026amp;len))\n\t{\n\t\tgoto End;\n\t}\n\n\tWSAPROTOCOL_INFO\u0026amp; data = info.Info;\n\tif(data.ProtocolChain.ChainLen != 1 //基礎服務提供者\n\t\t/*|| data.iAddressFamily != AF_INET\t//驗證 ip \n\t\t|| data.iSocketType != SOCK_STREAM\t//tcp\n\t\t*/\n\t\t)\n\t{\n\t\tgoto End;\n\t}\n\n\tstd::wcout\u0026lt;\u0026lt;\"***\t\"\u0026lt;\u0026lt;keyName\u0026lt;\u0026lt;\"\t***\\n\";\n\tstd::cout\u0026lt;\u0026lt;\"path : \"\u0026lt;\u0026lt;info.Path\u0026lt;\u0026lt;\"\\n\";\n\n\nEnd:\n\tif(hSubKey)\n\t{\n\t\tRegCloseKey(hSubKey);\n\t}\n}\u003c/pre\u003e"
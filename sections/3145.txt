var __v="\n\u003cpre class='prettyprint linenums'\u003e//告訴編譯器 啟用TLS目錄\n#pragma comment(linker, \"/INCLUDE:__tls_used\") \n\n//回調函數定義\nVOID NTAPI tlsCallBack (\n    PVOID DllHandle,\t//模塊句柄\n    DWORD Reason,\t\t//調用原因 類似dll入口函數\n    PVOID Reserved\t\t//保留未使用 為0\n    )\n{\n\tswitch(Reason)\n\t{\n\tcase DLL_PROCESS_DETACH:\t//進程要被終止 包括第一個線程\n\t\tbreak;\n\tcase DLL_PROCESS_ATTACH:\t//啟動了一個進程 包括第一個線程\n\t\tMessageBox(NULL,L\"before run\",L\"tls\",MB_OK);\n\t\tbreak;\n\tcase DLL_THREAD_ATTACH:\t\t//新啟一個線程(不包括第一個主線程)\n\t\tbreak;\n\tcase DLL_THREAD_DETACH:\t\t//線程將要被終止(不包括第一個主線程)\n\t\tbreak;\n\t}\n}\n\n//指定回調函數\n#pragma data_seg(\".CRT$XLB\")\nPIMAGE_TLS_CALLBACK p_thread_callback = tlsCallBack;\n//PIMAGE_TLS_CALLBACK p_thread_callback[]={tlsCallBack,tlsCallBack1,tlsCallBack,...}\t多個回調\n\n/*这是创建一个tls段\n\".CRT$XLB\"的含义是：\n.CRT表明是使用C RunTime机制\n$后面的XLB中\nX表示随机的标识\nL表示是TLS callback section\nB可以被换成B到Y的任意一个字母，但是不能使用\".CRT$XLA\"和\".CRT$XLZ\"\n因为\".CRT$XLA\"和\".CRT$XLZ\"是用于tlssup.obj的\n*/\n#pragma data_seg()\u003c/pre\u003e"
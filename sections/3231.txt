var __v="\n\u003cpre class='prettyprint linenums'\u003eEXCEPTIOIN unloadDriver(const std::wstring\u0026amp; driver_name)\n{\n\tSC_HANDLE  sc_handle_scm=NULL,sc_handle_service=NULL;\n\ttry\n\t{\n\t\t//打开服务管理器\n\t\tsc_handle_scm=OpenSCManager(NULL,NULL,SC_MANAGER_ALL_ACCESS);\n\t\tif(!sc_handle_scm)\n\t\t{\n\t\t\tstd::exception e(\"打开scm服务管理器失败\",GetLastError());\n\t\t\tthrow e;\n\t\t}\n\n\t\t//打开服务句柄\n\t\tsc_handle_service=OpenService(sc_handle_scm,driver_name.c_str(),SC_MANAGER_ALL_ACCESS );\n\t\tif(!sc_handle_service)\n\t\t{\n\t\t\tdark::debug::wexception e(L\"打开服务句柄失败\",GetLastError());\n\t\t\tthrow e;\n\t\t}\n\t\n\t\tSERVICE_STATUS service_status;\n\t\tif(!ControlService(sc_handle_service,SERVICE_CONTROL_STOP//更改服务状态 此为停止服务\n\t\t\t,\u0026amp;service_status))\n\t\t{\n\t\t\tdark::debug::wexception e(L\"停止服务失败\",GetLastError());\n\t\t\tthrow e;\n\t\t}\n\t\tif(!DeleteService(sc_handle_service))\n\t\t{\n\t\t\tdark::debug::wexception e(L\"卸载服务失败\",GetLastError());\n\t\t\tthrow e;\n\t\t}\n\n\t\tdark::debug::wexception e(false);\n\t\tthrow e;\n\t}\n\tcatch(const dark::debug::wexception\u0026amp; e)\n\t{\n\t\tif(sc_handle_scm)\n\t\t{\n\t\t\tCloseServiceHandle(sc_handle_scm);\n\t\t}\n\t\tif(sc_handle_service)\n\t\t{\n\t\t\tCloseServiceHandle(sc_handle_service);\n\t\t}\n\t\n\t\tif(e.isException())\n\t\t{\n\t\t\tthrow e;\n\t\t}\n\t}\n\n}\u003c/pre\u003e"
var __v="\n\u003cpre class='prettyprint linenums'\u003e#include\u0026lt;WinIoCtl.h\u0026gt;\nvoid CloaderDriverDlg::OnBnClickedButtonWrite()\n{\n\tCString wcs,link_name;\n\tGetDlgItemText(IDC_EDIT_WRITE,wcs);\n\tGetDlgItemText(IDC_EDIT2,link_name);\n\twcs.Trim();\n\tlink_name.Trim();\n\tif(wcs.IsEmpty() || link_name.IsEmpty() || wcs.GetLength()\u0026gt;BUFFER_SIZE-1)\n\t{\n\t\treturn;\n\t}\n\n\tHANDLE handle_file = CreateFile(link_name.GetBuffer(),GENERIC_WRITE | GENERIC_READ,0,NULL,OPEN_EXISTING,FILE_ATTRIBUTE_NORMAL,0);\n\n\tif( handle_file ==INVALID_HANDLE_VALUE)\n\t{\n\t\tMessageBox(L\"无法打开指定设备\");\n\t\treturn;\n\t}\n\t\n\twchar_t in_buffer[BUFFER_SIZE]={0},\n\t\tout_buffer[BUFFER_SIZE]={0};\n\twcscpy_s(in_buffer,_countof(in_buffer),wcs.GetBuffer());\n\t\n\tDWORD out_size;\n\tif(!DeviceIoControl(handle_file, IOCTL_DIRECT_IN, in_buffer, (wcslen(in_buffer)+1)*sizeof(wchar_t), out_buffer, sizeof(wchar_t)*BUFFER_SIZE, \u0026amp;out_size, NULL))\n\t{\n\t\twcs.Format(L\"DeviceIoControl 失败 ErrorCode=%d\",GetLastError());\n\t\tMessageBox(wcs);\n\t}\n\n\tCloseHandle(handle_file);\n\twcs.Format(L\"%d output %s\",out_size,out_buffer);\n\tSetDlgItemText(IDC_EDIT_OUT,wcs);\n}\n    \nvoid CloaderDriverDlg::OnBnClickedButtonRead()\n{\n\tCString wcs,link_name;\n\tGetDlgItemText(IDC_EDIT2,link_name);\n\tlink_name.Trim();\n\tif(link_name.IsEmpty())\n\t{\n\t\treturn;\n\t}\n\n\tHANDLE handle_file = CreateFile(link_name.GetBuffer(),GENERIC_WRITE | GENERIC_READ,0,NULL,OPEN_EXISTING,0,0);\n\n\tif( handle_file ==INVALID_HANDLE_VALUE)\n\t{\n\t\tMessageBox(L\"无法打开指定设备\");\n\t\treturn;\n\t}\n\twchar_t out_buffer[BUFFER_SIZE]={0};\n\t\n\tDWORD out_size;\n\tif(!DeviceIoControl(handle_file, IOCTL_DIRECT_OUT, NULL, 0, out_buffer, sizeof(wchar_t)*BUFFER_SIZE, \u0026amp;out_size, NULL))\n\t{\n\t\twcs.Format(L\"DeviceIoControl 失败 ErrorCode=%d\",GetLastError());\n\t\tMessageBox(wcs);\n\t}\n\n\tCloseHandle(handle_file);\n\twcs.Format(L\"%d output %s\",out_size,out_buffer);\n\tSetDlgItemText(IDC_EDIT_READ,wcs);\n}\u003c/pre\u003e"
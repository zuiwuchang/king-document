var __v="\u003cpre class=\"k-pre\"\u003e缓冲区模式下 系统先把写入 内容 拷贝到 pIrp-\u0026gt;AssociatedIrp.SystemBuffer\n同时 输出时将 pIrp-\u0026gt;AssociatedIrp.SystemBuffer 指向的内容拷贝给 用户输出缓冲区\n\n#pragma PAGE_MEMORY\nNTSTATUS WriteDirectBufferIn(IN PIRP pIrp,ULONG inSize,ULONG outSize)\n{\n\tKdPrint((\"WriteDirectBufferIn begin\\n\"));\n\tNTSTATUS status = STATUS_SUCCESS;\n\t\n\t//获取用户层传入的 输入缓冲区内容拷贝 的地址\n\tPVOID lp_input_buffer=pIrp-\u0026gt;AssociatedIrp.SystemBuffer,\n\t\tlp_output_buffer=pIrp-\u0026gt;AssociatedIrp.SystemBuffer; //缓冲区模式 输入输出 是同一地址\n\n\n\tUNICODE_STRING unicode_string;\n\tRtlInitUnicodeString(\u0026amp;unicode_string,L\"写入数据成功\");\n\tRtlCopyMemory(lp_output_buffer,unicode_string.Buffer,unicode_string.Length);\n\t\n\tpIrp-\u0026gt;IoStatus.Information=unicode_string.Length;\n\n\n\tKdPrint((\"WriteDirectBufferIn end\\n\"));\n\treturn status;\n}\n\n#pragma PAGE_MEMORY\nNTSTATUS ReadDirectBufferOut(IN PIRP pIrp,ULONG inSize,ULONG outSize)\n{\n\tKdPrint((\"ReadDirectBufferOut begin\\n\"));\n\tNTSTATUS status = STATUS_SUCCESS;\n\t\n\tPVOID lp_output_buffer=pIrp-\u0026gt;AssociatedIrp.SystemBuffer;\n\n\tUNICODE_STRING unicode_string;\n\tRtlInitUnicodeString(\u0026amp;unicode_string,L\"读取数据成功\");\n\tRtlCopyMemory(lp_output_buffer,unicode_string.Buffer,unicode_string.Length);\n\t\n\tpIrp-\u0026gt;IoStatus.Information=unicode_string.Length;\n\n\tKdPrint((\"ReadDirectBufferOut end\\n\"));\n\treturn status;\n}\n\u003c/pre\u003e"
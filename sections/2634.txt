var __v="\n\u003cpre class='prettyprint linenums'\u003e#include \u0026lt;windows.h\u0026gt; \n#include \u0026lt;stdio.h\u0026gt; \n \nBOOL WINAPI CtrlHandler(DWORD fdwCtrlType) \n{ \n\tswitch( fdwCtrlType ) \n\t{\n\tcase CTRL_C_EVENT:\n\t\t//return TRUE 可以使軟體忽略 ctrl + c\n\t\tprintf( \"Ctrl-C event\\n\\n\" );\n\t\treturn FALSE;\n\tcase CTRL_CLOSE_EVENT:\n\t\t//關閉 console 窗口時\n\t\t//一般會有5秒超時 超時後 os強制結束進程\n\t\tprintf( \"Ctrl-Close event\\n\\n\" );\n\t\treturn FALSE;\n\tcase CTRL_BREAK_EVENT: \n\t\tprintf( \"Ctrl-Break event\\n\\n\" );\n\t\treturn FALSE; \n\tcase CTRL_LOGOFF_EVENT: \n\t\t//用戶登出時\n\t\t//一般會有20秒超時 超時後 os強制結束進程\n\t\tprintf( \"Ctrl-Logoff event\\n\\n\" );\n\t\treturn FALSE;\n\tcase CTRL_SHUTDOWN_EVENT: \n\t\t//os 關閉前 得到通知\n\t\t//一般會有20秒超時 超時後 os強制結束進程\n\t\tprintf( \"Ctrl-Shutdown event\\n\\n\" );\n\t\treturn FALSE;\n\t}\n\treturn FALSE;\n}\n\nint main( void ) \n{\n\tif(SetConsoleCtrlHandler(  CtrlHandler, TRUE ) ) \n\t{ \n\t\tprintf( \"\\nThe Control Handler is installed.\\n\" ); \n\t\tprintf( \"\\n -- Now try pressing Ctrl+C or Ctrl+Break, or\" ); \n\t\tprintf( \"\\n    try logging off or closing the console...\\n\" ); \n\t\tprintf( \"\\n(...waiting in a loop for events...)\\n\\n\" ); \n \n\t\twhile( 1 ){ } \n\t} \n\telse \n\t{\n\t\tprintf( \"\\nERROR: Could not set control handler\"); \n\t\treturn 1;\n\t}\n\treturn 0;\n}\u003c/pre\u003e"
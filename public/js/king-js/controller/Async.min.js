(function(d){var a=d.king;a.controller=a.controller||{};a.controller.NameAsync=a.controller.NameAsync||"king.controller.Async";a.controller.NewAsync=a.controller.NewAsync||function(){var d=a.controller,m=a.NewObject(),e="none",g=[],h=0,k,f,n,l;m.Extend(d.NameAsync,{Status:function(){return e},Sync:function(c,b){g.push({Func:c,OnError:b});return this},Notify:function(c){if("runing"!=e)return this.log("Notify","Async not runing"),this;c||(c={});var b=c.Error,a=c.Content;a||(a=null);if(b){e="error";
c=n;var d=!0;c&&(d=c(b,a));d&&l&&l(b,a);f&&f(b,a)}else return b=null,g.length>h?(b=g[h],n=b.OnError,++h,b.Func(this,c.Content)):(e="ok",k&&k(a),f&&f(b,a)),this},Do:function(a){if("none"!=e)return this.log("Notify","Async status must be none"),this;e="runing";a||(a={});k=a.Ok;f=a.End;l=a.Error;this.Notify({});return this}});return m}})(this);
